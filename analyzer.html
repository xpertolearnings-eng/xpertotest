<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xperto - AI Analyzer</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='50' fill='%2300C853'/></svg>">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX Transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- PDF.js for Resume Parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script>pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js`;</script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            cursor: none; 
            background-color: #000; 
        }

        .custom-cursor {
            position: fixed;
            width: 24px;
            height: 24px;
            border: 2px solid #00C853;
            border-radius: 50%;
            pointer-events: none;
            transform: translate(-50%, -50%);
            transition: width 0.2s, height 0.2s, background-color 0.2s;
            z-index: 9999;
            left: -100px; /* Initially hide off-screen */
        }

        button:hover ~ .custom-cursor, a:hover ~ .custom-cursor, [onclick]:hover ~ .custom-cursor, input[type=file] ~ .custom-cursor, label:hover ~ .custom-cursor {
             width: 40px;
             height: 40px;
             background-color: rgba(0, 200, 83, 0.1);
        }

        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
        
        @keyframes slide-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-in-up {
            animation: slide-in-up 0.6s ease-out forwards;
        }

    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- GEMINI API CALL HELPERS ---
        
        // **FIX**: A robust JSON parser and repairer. This will catch common AI formatting
        // errors (like trailing commas) that cause the application to crash.
        const parseAndRepairJSON = (text) => {
            try {
                // Happy path: the JSON is already valid.
                return JSON.parse(text);
            } catch (e) {
                console.warn("Initial JSON.parse failed. Attempting to repair.", e);
            }

            // If parsing fails, find the start and end of the JSON object to clean it.
            let repairedText = text.trim();
            const firstBracket = repairedText.indexOf('{');
            const lastBracket = repairedText.lastIndexOf('}');

            if (firstBracket === -1 || lastBracket === -1 || lastBracket < firstBracket) {
                throw new Error("Could not find a valid JSON object in the AI's response.");
            }

            repairedText = repairedText.substring(firstBracket, lastBracket + 1);

            // Perform final, aggressive repairs on the extracted object.
            try {
                // This regex finds and removes trailing commas in objects and arrays,
                // which is the most common cause of this specific JSON error.
                const fixedJsonString = repairedText.replace(/,\s*([}\]])/g, "$1");
                return JSON.parse(fixedJsonString);
            } catch (e) {
                 console.error("Failed to parse JSON even after multiple repair attempts.", e);
                 console.error("Problematic string after repairs:", repairedText);
                 throw new Error("The AI's response was malformed and could not be repaired.");
            }
        };

        const callGeminiAPI = async (systemPrompt) => {
            try {
                const url = window.location.origin + '/.netlify/functions/call-gemini';
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: systemPrompt }),
                });

                // **FIX**: Get the response as raw text first, so our repair function can clean it.
                const rawText = await response.text();

                if (!response.ok) {
                    let errorDetails = rawText;
                    try { errorDetails = JSON.parse(rawText).details || rawText; } 
                    catch (e) { /* Ignore if error response isn't JSON */ }
                    throw new Error(`Network response was not ok: ${response.status}. ${errorDetails}`);
                }
                
                // Use the new, robust repair function instead of the standard JSON.parse.
                const report = parseAndRepairJSON(rawText);
                console.log("Received and parsed report from Netlify function:", report);
                return report;
            } catch (error) {
                console.error("Failed to fetch analysis from Netlify function:", error);
                throw error;
            }
        };
        
        const sanitizeTextForAI = (text) => {
             return text
                .replace(/’/g, "'") // Replace smart single quotes
                .replace(/“|”/g, '"') // Replace smart double quotes
                .replace(/[\u200B-\u200D\uFEFF]/g, '') // Remove zero-width spaces
                .replace(/\\/g, '\\\\')  // Escape backslashes
                .replace(/"/g, '\\"')   // Escape double quotes
                .replace(/\r\n|\r|\n/g, '\\n'); // Consolidate and escape newlines
        };

        const callResumeGeminiAPI = (resumeText) => {
            console.log("Calling Netlify for initial FREE analysis...");
            const sanitizedResumeText = sanitizeTextForAI(resumeText);
            const systemPrompt = `
            You are 'Xperto AI', a world-class resume analyzer. Your output MUST be a single, valid JSON object with no extra text or markdown.

            **Core Directives:**
            1.  **Generate FREE Content Only:** Create only the initial analysis. This includes the overall score, summary, top 5 fixes, and the basic structure for the 5 sections (id, title, score, freeFindings, quickTips).
            2.  **DO NOT Generate Locked Content:** The 'lockedContent' field in the sections array must be an empty object: {}.
            3.  **Hyper-Personalization:** Find 5 specific weak sentences/points in the resume to use as direct quotes for the "before" field in the 'topFixes'.
            4.  **Realistic Scoring:** Scores (0-100) are based on content quality. 'overallScore' is the average of the 5 section scores.
            5.  **CRITICAL OUTPUT FORMAT:** The entire response must be a single, valid JSON object.
            6.  **Brevity Mandate:** Keep all text concise.

            **JSON Schema to Follow:**
            {
              "overallScore": "<number>",
              "overallSummary": "<string>",
              "topFixes": [
                {
                  "id": "<string>", "title": "<string>", "problem": "<string>",
                  "solution": { "explanation": "<string>", "before": "<string>", "after": "<string>" },
                  "sectionId": "<string>"
                }
              ],
              "sections": [
                { "id": "summary", "title": "Professional Summary", "score": "<number>", "freeFindings": ["<string>"], "quickTips": ["<string>"], "lockedContent": {}},
                { "id": "experience", "title": "Work Experience", "score": "<number>", "freeFindings": ["<string>"], "quickTips": ["<string>"], "lockedContent": {}},
                { "id": "projects", "title": "Projects", "score": "<number>", "freeFindings": ["<string>"], "quickTips": ["<string>"], "lockedContent": {}},
                { "id": "skills", "title": "Skills Section", "score": "<number>", "freeFindings": ["<string>"], "quickTips": ["<string>"], "lockedContent": {}},
                { "id": "education", "title": "Education", "score": "<number>", "freeFindings": ["<string>"], "quickTips": ["<string>"], "lockedContent": {}}
              ]
            }

            **Resume Text to Analyze:**
            ---
            ${sanitizedResumeText}
            ---`;
            return callGeminiAPI(systemPrompt);
        };
        
        const callLockedContentGeminiAPI = (resumeText) => {
            console.log("Calling Netlify for DETAILED (locked) content...");
            const sanitizedResumeText = sanitizeTextForAI(resumeText);
            const systemPrompt = `
            You are 'Xperto AI', a resume analyzer. Based on the provided resume, generate ONLY the detailed 'lockedContent' for each of the 5 sections.

            **Core Directives:**
            1.  **Generate LOCKED Content Only:** Your entire output must be a single JSON object with one key: "detailedSections". This key holds an array of 5 objects.
            2.  **Object Structure:** Each object in the array must have two keys: the section 'id' and the 'lockedContent' object.
            3.  **CRITICAL OUTPUT FORMAT:** Adhere strictly to the JSON schema. No extra text or markdown.
            4.  **Brevity Mandate:** Keep explanations concise to avoid truncation.

            **JSON Schema to Follow:**
            {
              "detailedSections": [
                { 
                  "id": "summary", 
                  "lockedContent": { "detailedTips": ["<string>"], "examples": [{ "before": "<string>", "after": "<string>" }], "explanation": "<string>" }
                },
                { 
                  "id": "experience", 
                  "lockedContent": { "detailedTips": ["<string>"], "examples": [{ "before": "<string>", "after": "<string>" }], "explanation": "<string>" }
                },
                { 
                  "id": "projects", 
                  "lockedContent": { "detailedTips": ["<string>"], "examples": [{ "before": "<string>", "after": "<string>" }], "explanation": "<string>" }
                },
                { 
                  "id": "skills", 
                  "lockedContent": { "detailedTips": ["<string>"], "examples": [{ "before": "<string>", "after": "<string>" }], "explanation": "<string>" }
                },
                { 
                  "id": "education", 
                  "lockedContent": { "detailedTips": ["<string>"], "examples": [{ "before": "<string>", "after": "<string>" }], "explanation": "<string>" }
                }
              ]
            }

            **Resume Text to Analyze:**
            ---
            ${sanitizedResumeText}
            ---`;
            return callGeminiAPI(systemPrompt);
        };
        
        // --- ASSETS & ICONS ---
        const Logo = () => (
            <svg className="h-8 w-auto text-gray-100" viewBox="0 0 170 50" xmlns="http://www.w3.org/2000/svg">
                <text x="0" y="36" fontFamily="Inter, system-ui, sans-serif" fontSize="38" fontWeight="bold" fill="currentColor">
                    Xpert
                </text>
                <g transform="translate(118, 0)">
                    <path d="M 25 2.5 A 22.5 22.5 0 1 1 2.5 25" stroke="#00C853" strokeWidth="3.5" fill="none" strokeLinecap="round" />
                    <path d="M 25 47.5 A 22.5 22.5 0 1 1 47.5 25" stroke="#64ffda" strokeWidth="3.5" fill="none" strokeLinecap="round" />
                    <circle cx="2.5" cy="25" r="4.5" fill="#00C853" />
                    <circle cx="47.5" cy="25" r="4.5" fill="#64ffda" />
                    <circle cx="25" cy="2.5" r="4.5" fill="white" />
                </g>
            </svg>
        );

        const LockIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 inline-block mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>);
        const CheckIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-green-400 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>);
        const ChevronDownIcon = ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" className={className || "h-5 w-5"} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" /></svg>);

        // --- CORE UI COMPONENTS ---
        const Header = () => {
            const [isMenuOpen, setIsMenuOpen] = React.useState(false);
            const navItems = [
                { id: 'home', label: 'Home', href: '/index.html' },
                { id: 'courses', label: 'Courses', href: '/courses.html' },
                { id: 'analyzer', label: 'AI Analyzer', href: '/analyzer.html' },
                { id: 'freelance', label: 'Find Internships', href: '/internships.html' },
            ];
            
            const currentPage = window.location.pathname.split('/').pop().split('.')[0] || 'index';
            const activePageId = currentPage === 'index' ? 'home' : currentPage;

            return (
                <header className="bg-black/50 backdrop-blur-md sticky top-0 z-40 border-b border-gray-800">
                    <nav className="container mx-auto px-4 sm:px-6 py-4 flex justify-between items-center">
                        <a href="/index.html" className="flex items-center cursor-pointer">
                            <Logo />
                        </a>
                        <div className="hidden md:flex items-center space-x-8">
                            {navItems.map(item => (
                                <a key={item.id} href={item.href} className={`text-gray-300 hover:text-white transition-colors duration-300 relative group ${activePageId === item.id ? 'font-semibold text-white' : ''}`}>
                                    {item.label}
                                    <span className={`absolute bottom-[-4px] left-0 w-full h-0.5 bg-[#00C853] transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300 ${activePageId === item.id ? 'scale-x-100' : ''}`}></span>
                                </a>
                            ))}
                        </div>
                        <div className="flex items-center space-x-4">
                            <button onClick={() => alert('Login functionality placeholder')} className="hidden sm:block px-5 py-2 text-sm font-medium text-gray-200 bg-gray-800 rounded-lg border border-gray-700 hover:bg-gray-700 focus:outline-none transition-all duration-300 hover:scale-105">Login</button>
                            <div className="md:hidden">
                                <button onClick={() => setIsMenuOpen(!isMenuOpen)} className="text-gray-300 hover:text-white p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-inset focus:ring-green-500">
                                    <span className="sr-only">Open main menu</span>
                                    {isMenuOpen ? (
                                        <svg className="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" /></svg>
                                    ) : (
                                        <svg className="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                                    )}
                                </button>
                            </div>
                        </div>
                    </nav>
                    {isMenuOpen && (
                        <div className="md:hidden animate-fade-in">
                            <div className="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                                {navItems.map(item => (
                                    <a key={item.id} href={item.href} className={`block w-full text-left px-3 py-2 rounded-md text-base font-medium transition-colors ${activePageId === item.id ? 'bg-gray-900 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}`}>
                                        {item.label}
                                    </a>
                                ))}
                                 <button onClick={() => alert('Login functionality placeholder')} className="sm:hidden block w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-300 hover:bg-gray-700 hover:text-white">Login</button>
                            </div>
                        </div>
                    )}
                </header>
            );
        };

        const Footer = () => (
            <footer className="bg-gray-900 text-white border-t border-gray-800">
                <div className="container mx-auto px-4 sm:px-6 py-12">
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-8">
                        <div>
                            <h3 className="font-bold text-lg mb-4">Xperto</h3>
                            <p className="text-gray-400 text-sm">Upskilling India's Future Workforce.</p>
                        </div>
                        <div>
                            <h3 className="font-semibold mb-4">Navigate</h3>
                            <ul className="space-y-2 text-gray-400 text-sm">
                                <li><a href="/courses.html" className="hover:text-[#00C853]">Courses</a></li>
                                <li><a href="/analyzer.html" className="hover:text-[#00C853]">AI Analyzer</a></li>
                                <li><a href="/internships.html" className="hover:text-[#00C853]">Find Internships</a></li>
                            </ul>
                        </div>
                        <div>
                            <h3 className="font-semibold mb-4">Legal</h3>
                            <ul className="space-y-2 text-gray-400 text-sm">
                                <li><a href="#" className="hover:text-[#00C853]">Terms of Service</a></li>
                                <li><a href="#" className="hover:text-[#00C853]">Privacy Policy</a></li>
                            </ul>
                        </div>
                        <div>
                            <h3 className="font-semibold mb-4">Connect</h3>
                            <ul className="space-y-2 text-gray-400 text-sm">
                                <li><a href="#" className="hover:text-[#00C853]">Twitter</a></li>
                                <li><a href="#" className="hover:text-[#00C853]">LinkedIn</a></li>
                            </ul>
                        </div>
                    </div>
                    <div className="mt-12 border-t border-gray-700 pt-8 text-center text-gray-500 text-sm">
                        <p>&copy; {new Date().getFullYear()} Xperto. All rights reserved.</p>
                    </div>
                </div>
            </footer>
        );

        const NotificationCenter = ({ notifications }) => (
            <div className="fixed bottom-5 right-5 z-50 space-y-3">
                {notifications.map(n => (
                    <div key={n.id} className={`px-4 py-3 rounded-lg shadow-lg text-white font-semibold animate-slide-in-up ${n.type === 'success' ? 'bg-green-600' : 'bg-red-600'}`}>
                        {n.message}
                    </div>
                ))}
            </div>
        );

        const Card = ({ children, className }) => (
            <div className={`bg-gray-900 rounded-2xl border border-gray-800 overflow-hidden transition-all duration-300 hover:border-[#00C853]/50 hover:shadow-[0_0_20px_rgba(0,200,83,0.3)] ${className}`}>
                {children}
            </div>
        );

        // --- PAGE ---
        const AnalyzerPage = ({ showNotification }) => {
            const [analyzerType, setAnalyzerType] = React.useState('resume');
            const [file, setFile] = React.useState(null);
            const [fileText, setFileText] = React.useState('');
            const [linkedinUrl, setLinkedinUrl] = React.useState('');
            const [report, setReport] = React.useState(null);
            const [isReportUnlocked, setIsReportUnlocked] = React.useState(false);
            const [loading, setLoading] = React.useState(false);
            const [unlocking, setUnlocking] = React.useState(false);
            const [activeView, setActiveView] = React.useState({ type: null, id: null });
            const [openAccordionId, setOpenAccordionId] = React.useState(null);

            const resetState = () => {
                setFile(null); setFileText(''); setLinkedinUrl('');
                setReport(null); setIsReportUnlocked(false);
                setLoading(false); setUnlocking(false);
                setActiveView({ type: null, id: null });
                setOpenAccordionId(null);
            };

            React.useEffect(() => { resetState(); }, [analyzerType]);

            const getScoreColor = (score) => {
                if (score < 50) return '#ef4444';
                if (score < 80) return '#facc15';
                return '#4ade80';
            };

            const handleFileChange = async (e) => {
                const uploadedFile = e.target.files[0];
                if (!uploadedFile) return;
                setFile(uploadedFile);
                const reader = new FileReader();
                reader.onload = async (event) => {
                    const typedarray = new Uint8Array(event.target.result);
                    try {
                        const pdf = await pdfjsLib.getDocument(typedarray).promise;
                        let textContent = '';
                        for (let i = 1; i <= pdf.numPages; i++) {
                            const page = await pdf.getPage(i);
                            const text = await page.getTextContent();
                            textContent += text.items.map(s => s.str).join(' ');
                        }
                        setFileText(textContent);
                        showNotification('File loaded successfully!', 'success');
                    } catch (error) {
                        console.error("Error parsing PDF:", error);
                        showNotification('Could not read the PDF file.', 'error');
                        setFile(null); setFileText('');
                    }
                };
                reader.readAsArrayBuffer(uploadedFile);
            };

            const handleAnalyze = async () => {
                if ((analyzerType === 'resume' && !fileText) || (analyzerType === 'linkedin' && !linkedinUrl)) {
                    showNotification(analyzerType === 'resume' ? 'Please upload a resume.' : 'Please enter a LinkedIn URL.', 'error');
                    return;
                }
                setLoading(true); setReport(null);
                try {
                    const result = await callResumeGeminiAPI(fileText);
                    setReport(result);
                    if (result.topFixes && result.topFixes.length > 0) {
                        setActiveView({ type: 'top_fixes', id: result.topFixes[0].id });
                        setOpenAccordionId(result.topFixes[0].id);
                    }
                    showNotification('Free analysis complete!', 'success');
                } catch (error) {
                    console.error("Analysis failed:", error);
                    showNotification(`Analysis failed: ${error.message}`, 'error');
                } finally {
                    setLoading(false);
                }
            };
            
            const handleUnlock = async () => {
                setUnlocking(true);
                try {
                    const lockedData = await callLockedContentGeminiAPI(fileText);
                    setReport(prevReport => {
                        const newSections = prevReport.sections.map(section => {
                            const detailedContent = lockedData.detailedSections.find(d => d.id === section.id);
                            return { ...section, lockedContent: detailedContent ? detailedContent.lockedContent : {} };
                        });
                        return { ...prevReport, sections: newSections };
                    });
                    setIsReportUnlocked(true);
                    showNotification('Full Report Unlocked!', 'success');
                } catch (error) {
                     showNotification(`Could not unlock report: ${error.message}`, 'error');
                } finally {
                    setUnlocking(false);
                }
            };

            const ScoreDonut = ({ score }) => {
                const color = getScoreColor(score);
                const circumference = 2 * Math.PI * 45;
                const offset = circumference - (score / 100) * circumference;
                return (
                    <div className="relative w-32 h-32 sm:w-40 sm:h-40">
                        <svg className="w-full h-full" viewBox="0 0 100 100">
                            <circle cx="50" cy="50" r="45" fill="transparent" stroke="#374151" strokeWidth="10" />
                            <circle cx="50" cy="50" r="45" fill="transparent" stroke={color} strokeWidth="10" strokeDasharray={circumference} strokeDashoffset={offset} strokeLinecap="round" transform="rotate(-90 50 50)" style={{ transition: 'stroke-dashoffset 0.5s ease-in-out' }} />
                        </svg>
                        <div className="absolute inset-0 flex items-center justify-center"><span className="text-3xl sm:text-4xl font-bold" style={{ color }}>{score}</span></div>
                    </div>
                );
            };
            
            const LockedContent = ({ onUnlock, unlocking }) => (
                 <div className="mt-8 relative">
                    <div className="blur-sm pointer-events-none space-y-6 opacity-60">
                         <div>
                            <h3 className="text-lg font-semibold text-gray-200">Detailed Improvements</h3>
                            <p className="mt-2 text-sm text-gray-400 bg-gray-800/50 p-3 rounded-md">Unlock to see detailed, AI-powered suggestions and examples.</p>
                        </div>
                    </div>
                    <div className="absolute inset-0 bg-gray-900/80 flex flex-col items-center justify-center rounded-lg border border-dashed border-gray-700 p-4 text-center">
                        <button onClick={onUnlock} disabled={unlocking} className="px-6 py-3 font-semibold text-black bg-[#00C853] rounded-lg hover:bg-green-400 transition-colors flex items-center shadow-lg shadow-green-500/20 disabled:bg-gray-600 disabled:cursor-not-allowed">
                            <LockIcon /> {unlocking ? 'Unlocking...' : 'Unlock Full Report for ₹49'}
                        </button>
                    </div>
                </div>
            );

            const MainContentPane = ({ report, activeView, isReportUnlocked, onUnlock, unlocking }) => {
                if (!activeView.id || !report) return <div className="bg-gray-900 border border-gray-800 rounded-2xl p-6 sm:p-8 text-center hidden lg:block"><p className="text-gray-400">Select an item to see details.</p></div>;

                if (activeView.type === 'top_fixes') {
                    const topFix = report.topFixes.find(f => f.id === activeView.id);
                    if (!topFix) return null;
                    return (
                        <div className="bg-gray-900 border border-gray-800 rounded-2xl p-6 sm:p-8">
                            <h2 className="text-xl md:text-2xl font-bold text-white mb-1 break-words">Top Fix: <span className="text-[#00C853]">{topFix.title}</span></h2>
                            <p className="text-gray-400 mb-6 break-words">{topFix.problem}</p>
                            <div className="border-t border-gray-700 pt-6 space-y-6">
                                <div>
                                    <h3 className="text-lg md:text-xl font-bold text-green-400">The Solution</h3>
                                    <p className="mt-2 text-gray-300 break-words">{topFix.solution.explanation}</p>
                                </div>
                                <div className="p-4 border border-gray-700 rounded-lg">
                                    <p className="text-sm font-semibold text-red-400">Before:</p>
                                    <p className="text-sm text-gray-400 italic pl-4 border-l-2 border-red-500/50 ml-2 py-1 break-words">"{topFix.solution.before}"</p>
                                    <p className="text-sm font-semibold text-green-400 mt-3">After (Suggestion):</p>
                                    <p className="text-sm text-gray-200 pl-4 border-l-2 border-green-500/50 ml-2 py-1 whitespace-pre-wrap break-words">{topFix.solution.after}</p>
                                </div>
                            </div>
                        </div>
                    );
                }

                if (activeView.type === 'section') {
                    const section = report.sections.find(s => s.id === activeView.id);
                    if (!section) return null;
                    return (
                        <div className="bg-gray-900 border border-gray-800 rounded-2xl p-6 sm:p-8">
                            <div className="p-4 rounded-lg flex flex-col sm:flex-row items-center justify-between bg-gray-800 gap-4 sm:gap-2">
                                <h2 className="flex-grow text-xl md:text-2xl font-bold text-white text-center sm:text-left">{section.title}</h2>
                                <div className="flex items-center justify-center rounded-full bg-gray-900 font-bold w-14 h-14 text-2xl border-2 flex-shrink-0" style={{borderColor: getScoreColor(section.score), color: getScoreColor(section.score)}}>{section.score}</div>
                            </div>
                            <div className="mt-6 border-b border-gray-700 pb-6">
                                <h3 className="text-lg font-semibold text-white">Free Findings</h3>
                                <ul className="mt-3 space-y-2">{(section.freeFindings || []).map((finding, i) => <li key={i} className="flex items-start text-gray-300"><CheckIcon /><span>{finding}</span></li>)}</ul>
                            </div>
                             <div className="mt-6">
                                <h3 className="text-lg font-semibold text-white">Free Quick Fixes</h3>
                                <ul className="mt-3 space-y-2">{(section.quickTips || []).map((tip, i) => <li key={i} className="flex items-start text-gray-300"><CheckIcon /><span>{tip}</span></li>)}</ul>
                            </div>
                            {isReportUnlocked && section.lockedContent && section.lockedContent.detailedTips ? (
                                <div className="mt-8 space-y-8 animate-fade-in">
                                    <div>
                                        <h3 className="text-lg md:text-xl font-bold text-green-400">Detailed Improvements</h3>
                                        <ul className="mt-3 list-disc list-inside text-gray-300 space-y-2">{section.lockedContent.detailedTips.map((tip, i) => <li key={i}>{tip}</li>)}</ul>
                                    </div>
                                    <div>
                                        <h3 className="text-lg md:text-xl font-bold text-green-400">Rewritten Examples</h3>
                                        <div className="mt-3 space-y-4">
                                            {(section.lockedContent.examples || []).map((ex, i) => (
                                                <div key={i} className="p-4 border border-gray-700 rounded-lg">
                                                    <p className="text-sm font-semibold text-red-400">Before:</p><p className="text-sm text-gray-400 italic pl-4 border-l-2 border-red-500/50 ml-2 py-1">"{ex.before}"</p>
                                                    <p className="text-sm font-semibold text-green-400 mt-3">After:</p><p className="text-sm text-gray-200 pl-4 border-l-2 border-green-500/50 ml-2 py-1 whitespace-pre-wrap">{ex.after}</p>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                    <div>
                                        <h3 className="text-lg md:text-xl font-bold text-green-400">Why It Matters</h3>
                                        <p className="mt-2 text-gray-300">{section.lockedContent.explanation}</p>
                                    </div>
                                </div>
                            ) : ( <LockedContent onUnlock={onUnlock} unlocking={unlocking} /> )}
                        </div>
                    );
                }
                return null;
            };

            const AnalyzerInput = () => (
                <>
                    <div className="max-w-3xl mx-auto text-center">
                        <h1 className="text-3xl sm:text-4xl md:text-5xl font-bold text-white">AI Profile Analyzer</h1>
                        <p className="mt-4 text-gray-400">Get an instant analysis of your Resume or LinkedIn profile to identify weaknesses and outshine the competition.</p>
                    </div>
                    <div className="max-w-2xl mx-auto mt-12">
                        <div className="flex justify-center p-1 bg-gray-800 rounded-lg mb-6">
                            <button onClick={() => setAnalyzerType('resume')} className={`w-1/2 py-2.5 text-sm font-semibold rounded-md transition-colors ${analyzerType === 'resume' ? 'bg-[#00C853] text-black' : 'text-gray-400 hover:text-white'}`}>Resume Analyzer</button>
                            <button disabled className={`w-1/2 py-2.5 text-sm font-semibold rounded-md transition-colors ${analyzerType === 'linkedin' ? 'bg-[#00C853] text-black' : 'text-gray-400 hover:text-white'} cursor-not-allowed opacity-50`}>LinkedIn (Soon)</button>
                        </div>
                        <Card className="p-6 sm:p-8 hover:border-[#00C853]/50 transition-colors">
                            <div className="flex justify-center">
                                <label htmlFor="file-upload" className="cursor-pointer text-center p-8 border-2 border-dashed border-gray-600 rounded-xl hover:border-green-500 hover:bg-gray-800/50 transition-colors w-full">
                                    <svg xmlns="http://www.w3.org/2000/svg" className="mx-auto h-12 w-12 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>
                                    <p className="mt-2 font-semibold text-white">Click to Upload your Resume</p>
                                    <p className="text-xs text-gray-500">PDF up to 5MB</p>
                                </label>
                                <input id="file-upload" type="file" accept=".pdf" onChange={handleFileChange} className="hidden"/>
                            </div>
                            {file && <p className="mt-4 text-sm text-center text-gray-400">Selected: <span className="font-semibold text-gray-200">{file.name}</span></p>}
                            <button onClick={handleAnalyze} disabled={loading || !file} className="mt-6 w-full py-3 font-semibold text-black bg-[#00C853] rounded-lg hover:bg-green-400 disabled:bg-gray-600 disabled:cursor-not-allowed transition-transform duration-200 disabled:transform-none hover:scale-105">
                                {loading ? 'Analyzing...' : 'Grade My Resume'}
                            </button>
                        </Card>
                    </div>
                </>
            );

            return (
                <div className="container mx-auto px-4 sm:px-6 py-12 md:py-16 animate-fade-in min-h-screen">
                    {!report ? ( <AnalyzerInput /> ) : (
                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-4 md:gap-8 animate-slide-in-up">
                            <aside className="lg:col-span-4 xl:col-span-3">
                                <div className="p-4 rounded-xl bg-gray-900 border border-gray-800 lg:sticky lg:top-24">
                                    <div className="flex flex-col items-center">
                                        <ScoreDonut score={report.overallScore} />
                                        <p className="mt-3 text-center text-sm text-gray-400 break-words">{report.overallSummary}</p>
                                    </div>
                                    <h3 className="font-semibold text-gray-200 mt-6 mb-3 text-[#00C853]">Top 5 Actionable Fixes (Free)</h3>
                                    <div className="space-y-2">
                                        {(report.topFixes || []).map(fix => {
                                            const isAccordionOpen = openAccordionId === fix.id;
                                            return (
                                                <div key={fix.id} className={`rounded-lg overflow-hidden transition-colors ${isAccordionOpen ? 'bg-gray-800' : 'bg-transparent'}`}>
                                                    <button onClick={() => { setActiveView({ type: 'top_fixes', id: fix.id }); setOpenAccordionId(isAccordionOpen ? null : fix.id); }} className={`w-full text-left p-3 flex items-center border-2 transition-colors rounded-lg ${activeView.id === fix.id ? `border-green-500 lg:bg-gray-800` : 'border-transparent'} hover:bg-gray-800/50`}>
                                                        <div className="w-6 h-6 flex items-center justify-center rounded-md font-bold text-lg text-white flex-shrink-0 bg-green-600 mr-3"><svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" /></svg></div>
                                                        <p className="font-semibold text-gray-100 flex-grow truncate">{fix.title}</p>
                                                        <ChevronDownIcon className={`w-5 h-5 text-gray-400 lg:hidden transition-transform ${isAccordionOpen ? 'rotate-180' : ''}`} />
                                                    </button>
                                                </div>
                                            );
                                        })}
                                    </div>
                                    <div className="border-t border-gray-700 my-4"></div>
                                    <h3 className="font-semibold text-gray-200 mb-3">Detailed Report</h3>
                                    <div className="space-y-2">
                                        {(report.sections || []).map(section => {
                                             const isAccordionOpen = openAccordionId === section.id;
                                            return (
                                                <div key={section.id} className={`rounded-lg overflow-hidden transition-colors ${isAccordionOpen ? 'bg-gray-800' : 'bg-transparent'}`}>
                                                    <button onClick={() => { setActiveView({ type: 'section', id: section.id }); setOpenAccordionId(isAccordionOpen ? null : section.id);}} className={`w-full text-left p-3 flex items-center border-2 transition-colors rounded-lg ${activeView.id === section.id ? `border-green-500 lg:bg-gray-800` : 'border-transparent'} hover:bg-gray-800/50`}>
                                                        <p className="font-semibold text-gray-100 flex-grow">{section.title}</p>
                                                        <div className={`font-bold text-lg mr-3`} style={{color: getScoreColor(section.score)}}>{section.score}</div>
                                                        <ChevronDownIcon className={`w-5 h-5 text-gray-400 lg:hidden transition-transform ${isAccordionOpen ? 'rotate-180' : ''}`} />
                                                    </button>
                                                </div>
                                            );
                                        })}
                                    </div>
                                    <button onClick={resetState} className="w-full mt-4 py-2 text-sm font-semibold text-gray-300 bg-gray-800 rounded-lg hover:bg-gray-700 transition-colors">Analyze Another</button>
                                </div>
                            </aside>
                            <main className="lg:col-span-8 xl:col-span-9">
                                <MainContentPane report={report} activeView={activeView} isReportUnlocked={isReportUnlocked} onUnlock={handleUnlock} unlocking={unlocking} />
                            </main>
                        </div>
                    )}
                </div>
            );
        };
        
        // --- Main App Component ---
        const CustomCursor = () => {
            const cursorRef = React.useRef(null);
            React.useEffect(() => {
                if (cursorRef.current) {
                    const moveCursor = (e) => {
                        cursorRef.current.style.left = `${e.clientX}px`;
                        cursorRef.current.style.top = `${e.clientY}px`;
                    };
                    window.addEventListener('mousemove', moveCursor);
                    return () => window.removeEventListener('mousemove', moveCursor);
                }
            }, []);
            return <div ref={cursorRef} className="custom-cursor hidden md:block"></div>
        }

        function App() {
            const [notifications, setNotifications] = React.useState([]);
            const showNotification = (message, type = 'success') => {
                const id = Date.now();
                setNotifications(prev => [...prev, { id, message, type }]);
                setTimeout(() => {
                    setNotifications(prev => prev.filter(n => n.id !== id));
                }, 3000);
            };
            return (
                <div className="bg-black font-sans text-gray-300">
                    <CustomCursor />
                    <Header />
                    <main><AnalyzerPage showNotification={showNotification} /></main>
                    <Footer />
                    <NotificationCenter notifications={notifications} />
                </div>
            );
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>

